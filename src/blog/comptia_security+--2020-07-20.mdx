# All you need to know to pass the Comptia Security+   

This are all of my notes that I took during my studies that helped me pass the Comptia Security+ 
Exam in 2020. Most of the notes come from a course from Mike Mayers in Udemy called: 
TOTAL: CompTIA Security+ Certification (SY0-501) and the Book itself.  

I hope it helps you too.

## Table of Contents
1. [Risk and Management](#risk_management)
2. [Cryptography](#cryptography)
3. [Identity and Access Management](#identity_access_management)
4. [Tools of the Trade](#tools_trade)
5. [Securing Individual Systems](#securing_individual_systems)
6. [The Basic LAN](#the_basic_lan)
7. [Beyond the Basic LAN](#beyond_the_basic_lan)
8. [Secure Protocols](#secure_protocols)
9. [Testing Your Infrastructure](#testing_infrastructure)
10. [Dealing with Incidents](#dealing_incidents)


# Risk and Management <a name="risk_management"></a>
---
## The CIA triad of Security 
1. **Confidentiality:** Is the goal of keeping data secret from anyone who has the need or the right to access that data.
2. **Integrity:** Ensures that the data and systems, everything stays in an unaltered state (_non modified_) when stored, transimeted and recieved.
3. **Availability:** We have to ensure that systems and data are available to authorized users when needed.

Following these, we also need to keep in mind a couple of other factors:
**Auditing & Accountability:** We want to keep track of things that are happening on systems like: logs, data access, modified data...
**Non-Repudiation:** Ensures that a user can't deny about having made certain modifications or communications.

## Threat Actors
These are the kind of people or organizations that are going to be performing atacks to systems. It is good to identify these threads as:

1. **internal:** Threads coming from people inside of the organization.
2. **external:** Threads coming from the outside of an organization.
3. **level of sophistication:** The amount of evil a person or organization can do measured by their funding, resources and skills.
4. **intent:** What is their intention, goal or motivation to perform these attacks.

### Types of Threat Actors
**Script-kiddies:** Those are the kind of individuals that usually we are going to get rid of with an up to date system.  
**Hacktivists:** All of the attacks they perform are supporting a cause. They try to do bad things in order to prevent certain organizations to continue with their intentions.  
**Organized crime:** The main motivation for these people is making money.  
**Nation states:** Atacks in order to get premium data and information(gather intelligence). Their big goal is an APT(advanced persistent thread), which means hacking a system and staying there to get and monitor the information and intel.  
**Insider threats:** Any person (employee, contractor, subcontractor) who can access an asset.  

**OSINT:** Means open-source intelligence and provides a wide information to intrigue a threat actor. Examples might be any kind of social media platform and obviously the internet.

## What is Risk?
The potential to harm organizations, people, IT equipment...

**Assets:** Provide benefits to an organization, and are all of the parts of an infrastructured that we might be worried about getting harmed.  
**Vulnerabilities:** Weakness to an asset that it is open for a possible exploit.  
**Thread:** Exploit of a vulnerability. The person who performs the attack is called a _thread Agent_.  
**Likelihood:** The chance of something happening at any time and it is usually measured as a percentage. We can measure it regarding the quality _Qualitative likelihood_ or quantity _Quantitive likelihood_.  
**Impact:** Total harm caused by the thread. We also can look at it qualitative or quantitative.

It is very important to deal first with the risks that have a higher percentatge of likelihood and impact to an infrastructure.

We can found a Risk Assesment guide on a document called [SP 800-30](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-30r1.pdf) by NIST.

## Managing Risk
In order to manage the risk we are going need to perform a vulnerability and a threat assesment.

### Vulnerability Assesment
The first step is to find the possible vulnerabilities we may have. In order to find those we can use the common vulnerabilities and exposure database on [cve.mitre.org](cve.mitre.org).  
Once we get a list of the vulnerabilities we want to test we can use more active tools like _Nessus_. This program runs in localhost and it is going to provide us with a document with all the vulnerabilities that have found in the local area network. However, if we want to go more into detail about those vulnerabilities we are going to need a team of pentesters to test our network or systems.

### Threat Assesment
There is going to be different type of threads:
1. Adversarial (Hacker)
2. Incidental (User accidentally types another url and enters database)
3. Structural (equipment failure)
4. Enviromental (Fire in organization)

### Risk Response
Once we find a risk, we have to do something in order to prevent them and we do it several ways:    
1. **Mitigation** (effort to reduce impact the risk)
2. Risk transference (we contract a specific third party service to do a certain task Ex. cloud servers)
3. Risk acceptance (accept the risks in certain situation because it is very expensive to prevent and it is very unlikely to happen)
4. Risk avoidance (avoiding risks Ex. not holding id information because someon may steal it and I don't want to be involve with it)

### Framework
It is a methodolgy that helps you deal with risk managment.  
* [NIST Risk Management Framework Special Publication 800-37](https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-37r2.pdf)  
* [ISACA Risk IT Framework](http://www.isaca.org/Knowledge-Center/Research/Documents/Risk-IT-Framework-Excerpt_fmk_Eng_0109.pdf)  

## Using Guides for Risk Assesments
Using up to date guides to configure different OS systems or network infrastructure devices is very beneficial in order to make sure to set them up as a secure device. Therefore, we should always follow these directions coming from the different companies that manufacture them.

## Security Controls
It is a mechanism or action exexuted in order to protect our IT infrastructure and it is going to help us remediate problems. Security IT specialist uses security controls in order to prevent bad things to happen to our assets. For example: teaching employees to prevent social engineering attacks, setting up a firewall...

An IT specialist understand security controls and they can apply, monitor and adjust them based of the needs of the infastructure. There is different types of security controls:
1. **Administrative Control:** Control actions towards IT security and includes Laws, Policies, Guidelines, Best practices.  
2. **Technical Control:** Control actions IT systems towards IT security as computer staff, Firewalls, Password links, Authentication.
3. **Physical Control:** Control actions in the real world as Gates, Guards, Keys, Man traps.

### Security control Functions
* **Deterrent:** Stops the actor from even attempting the threat.
* **Preventative:** Stops the actor from performing the threat.
* **Detective:** Recognizes an actor's threat.
* **Corrective:** Mitigates the impact of a manifested threat.
* **Compensating:** provides alternative or temporary fixes to any of the above functions. 

### Interesitng Security Controls
* **Mandatory vacation:** It is used to detect fraud and unauthorized activity.
* **Job Rotation:** Enhances employees to know all different task in case the main guy is sick and can't do his job and also avoids people of being jealous of performing particular tasks.
* **Multi-person control:** Avoids a single person to take a bad action on a specific task and allows multiple people to make sure that something is done the right way.
* **Separation of Duties:** A single individual should not perform all critical or privilege duties across the board (Administrative control).
* **Principle of least privilege:** Users are granted only the level of privilege necessary for them to perform their jobs.

## Defense in depth 
There is to particular terms we have to get familiar with in order to start:  
* **Diversity:** Using a variety of controls in a random pattern.
* **Redundancy:** We have applied some kind of security control over and over. We use a bunch of layers to secure a system.

## IT Security Governance
It influences how the organization conducts IT security and there are different kind of sources:

* **Laws and Regulations**
* **Standards (Governamental or Industrial)**
* **Best practices**
* **Common sense**

Once we take a look at all of these different sources, our job will be to create two different documents:  

1. **Policies:** It is a document that defines how are we going to do something.  
	* Usually broad in nature.
		* Used as directives.
			* Define roles and responsabilities.

			2. **Organization standards:** Define the acceptable level of performance of a policy (much more detailed than a policy).

			Governance has the ultimate goal to make the right security controls  and precedures for our organization.

## Security Policies
### Acceptable use Policy
Defines what a person can and can't do in a company asset.
### Data Sensitivity and Classification Policies
We have to define how important types of data are. Ex: Highly confidential data...
### Access Control Policy
Defines how people can access to data. Ex: How employees authenticate, which data can a person access and how ...
### Password Policy
Defines how people have to deal with passwords. Ex: Long and complex passwords, how to get back a password, deal with multiple logins...
### Care and use of equipment
Explains how you borrow or maintain an equipment.
### Privacy Policies
Those are often for customers and define what private information the company gets from them and what are they going to do with that information.
### Personel Policy
If it has to do with a person and a personel.

## Quantitative Risk Calculation
How much is a particular incident going to affect a specifi asset.

* **Exposure Factor:** Percentage of an asset that's lost as the result of an incident.(Being 1 a total loss of the complete euipment).  

**Single Loss Expectancy =** Asset value * Exposure Factor  

**ARO(Annualized Rate of Ocurrence):** What is the chances of something happen in one year.  

SLE * ARO = **Anual Loss Expectancy** (It is going to tell you the cost of a particular incident annualy).  

## Business Impact Analysis
The study and analysis of the impact on your organization if you have a disruption in your business.

* **Determine mission process** Ex: make sure the servers are running.
* **Identify critical systems**
* **Single point-of-failure**
* **Identify resource requirements**
* **Identify recovery priorities**

The Impact of something that go wrong can come in form of people, finance or reputation.

## Organizing Data
How to deal with data is a big issue in IT security and we have several ways to do it:

**Data sensitivity/labeling**  
* Public Data: Has no restrictions
* Confidential: It is limitez to authorized viewing as agreed on by the parties involved.
*  Private: Limited to only the individual to whom the information is shared. Personally Identifiable information (PII).
* Proprietary: It is private information but at a corporate level.
* Protected Health Information: Private information for the Health of a particular individual. 

**Data Roles**  
* Owner: Legally responsible for the data.
* Steward/custodian: Person or organization who is responsible to maintain the accuracy and integrity of data.
* Privacy Officer: Individual who insures that data adheres to privacy policies and procedures.

**Data Users**  
Data users are categorized by roles which define the amount of data a user can access.  

* Users: Assigned standard permissions to complete task.
* Privileged users: Increased access and control relative to a user.
* Executive user: Person who set policy on data and incident response action. Has the access to read pretty much all the data. (Ex: Head Sales department)

**Data owner/System owner:** People or organizations who have legal ownership of the data and the system.

## Security Training
The biggest problem that we have in IT security is people and these people need training to avoid possible threads.

**Onboarding:** These are going to be Temporary contractor or new employees and we want to make sure they are secure people to hire. Therefore we should:  

* Make sure they pass a background check.
* In some cases, sign a Non-disclosure agreement (NDA), if some data is confidential.
* They have to learn the Standard operating procedures of the organization.
* Specialized issues like Keeping a clean desk all the time.
* Rules of behavior.
* General security policies.

**Offboarding:** When an employee leaves the organization.
* We should Disable all of his accounts.(Never delete an account!!)
* Make sure he returned all of his credentials.
* Exit Interview (In order to gather important information that the employee may have stored somewhere else).

**Personally identifiable information (PII)**  
This is a very important piece of information for the company to gather to make sure a employee might not be a thread or not loyal to the company.  

* **Information needed**  
	* Full name
		* Home address
			* Email address
				* National identification number 
					* Passport number
						* Vehicle registration plate number
							* Driver's license number
								* Face, fingerprints or handwriting
									* Credit card numbers
										* Digital identity
											* Date of birth 

### Role-based Data Controls
Personnel controls and role-based data controls help secure functions and data within an organization.  

1. **System owner**
	* Management level.
		* Maintains security of the system.
			* Defines a system administrator.
				* Works with all data owners to ensure data security.
				2. **System administrator**
					* Day to day administrator of a system.
						* Implement security controls.
						3. **Data owner**
							* Defines the sensitivity od the data.
								* Defines the protection of the data.
									* Works with the system owner to protecta data.
										* Defines access to the data.
										4. **User**
											* Accesses and uses the assigned data responsibly.
												* Monitors and reports security breaches.
												5. **Privileged User**
													* Has special acces to data beyond the typical user.
														* Works closely with system administrators to ensure data security.
														6. **Executive User**
															* Read only access but can look at all business data.

## Third party Agreements
### Business Partnership Agreement (BPA)
The most generic document, it is a document that has to be signed by both businesses in order to agree for a specific action and includes:
* Primary entities.
* Time Frame.
* Financial issues.
* Management. 

### Service Level Agreements (SLA)
When a third party is providing a service to you for example: Internet service.
* Service to be provided.
* Minimum up-time.
* Response time.
* Start and End date for the service.

### Interconnection Security Agreement (ISA)
Quantify how two federal entities can make data interconnections in a secure way.

1. Statement of requirements
	* Why are we interconnecting?
		* Who is interconnecting? 
		2. System security considerations
			* What information is interconnecting?
				* Where is this information going?
					* What services are involved?
						* What encryption is needed?
						3. Topological drawing
						4. Signature authority

						ISA agreements are technical documents and are usually reinforced with a memorandum of understanding.  

### Memorandum of Understanding/Agreement
It is very similar to a contract and it is used for two public agencies to have a legal methodology with dealing with eachother.

1. Purpose of the interconnection.
2. Relevant authorities.
3. Specify the responsabilities (Billing, downtime...)
4. Defines the terms of the agreement.
5. Termination.

# Cryptography <a name="cryptography"></a>
It is the science of taking data and make it invisible from the outside to bring it back later on. The main purpuse of cryptography is confidentiality.

**Obfuscation:** We take some data that makes sense and we hide it, for the purpose of not showing it to an outsider.

**Encryption/Decryption:** The two processes of cryptography.

Example: The Ceasar Cipher (It uses substitution in order to encrypt data).
**Viegenere Cypher:** A more complex cryptography method than the Ceasar.
**XOR Encryption:** Another method used with binary encryption.
**Cryptanalysis:** The science of decrypting encrypted data.
**Kerckhoff's principle:** Even if you understand the algorithm of an encryption, if you don't have the key ther's going to be any way to decrypt it.

## Cryptography methods
### Symetric encryption 
They only use one key to encrypt and decrypt the data and it is called a **Session key**. This form of encryption has two ways to send the key:
**In-band:** Send the key with the encrypted data (very risky).
**Out-of-band:** Send the key physically out of the internet (Anne goes to Bob's house and gives him the key on a piece of paper).

**Symetric encryption is the primary way we encrypt data**.
**Ephemeral key:** It is a temporary session key.

### Asymmetric Encryption
It uses two keys in order to exchange a session key in a secure way. The host generates a key pair with a **Public key** and **Private key**.

## Symmetric Cryptosystems
### Symetric key algorithm 
One way are the symetric **block** algorithms, that get a certain amount of data in blocks and encrypt them. The first type of encryption in blocks is called **Data Encryption Standard (DES)** (56-bit keys).  

DES can be hacked in some situations, especially if it has a short key and two alternatives to that are **Blow fish** (variable key size 32-448-bits) and **Triple DES** (168-bit keys).  

**Advanced Encryption Standard(AES)**  
After a while, Computer scientists created a modern symetric block encryption way more secure and that is the most up to date standard. Has key sizes of 128, 192 or 256-bits.

**Streaming cyphers:** Instead of encrypt blocks of bits, it will encrypt one bit at a time as it comes through the wire in a sudo-random manner. One method of streaming encryption is **RC4**(Rivest Cipher 4).

## Symmetric Block Modes
**Electronic Code Book:** Was the first generation of AES encryption and it uses the same key every time to generate the output. Therefore, ECB blocks will always output the same result that is why it is a problem sometimes to use it.  
Therefore, people have come with other much better solutions. All the following block modes use an initialization vector, which ensures the output block is uniquely different:  
**Cipher Block Chaining:** In this mode we encrypt the new data with the previous encrypted result.
**Cipher Feedback:** This mode is very similar to CBC, but it encrypts the inizialization value first and after that it generates a key which we are going to use to encrypt the final result. After that, that output is used for the next encryption packet.
**Output feedback:** Output feedback only uses the same Initialization vector every time to encrypt the data and then performs a final XOR on it.
**Counter (CTR):** It uses a NONCE + COUNTER(changes incremental) to encrypt the data to generate a new key every block and then perform the final XOR on the data to generate output.

## RSA Cryptosystems
Symetrics algorithms have a big problem, it uses the same key to encryt and decrypt. This, in the real world that can cause some serious issues.  
That is why we are also in need of **Asymetric Encription** which uses two keys one to encrypt (Public key) and another to decrypt(Private key).

### RSA
Asymetric algorithm that specifies how a host generates an individual key pair and how we send public keys to different parties.

### ECC (Eliptic Curve Cryptography)
It can provide very small keys that we can use and move around with the same robustness as RSA with increased performance.

## Diffie-Hellman (key exchange protocol)
Asymetric algorithm that provides a methodology for two parties to come up to the same session key. 

## PGP/GPG
Was originally invented for sending encrypted emails so other people couldn't read them. Today it has multiple uses as: encrypt files, partitions, drives ...

## HASH
It takes a large amount of data and converted in a certain unreadable format.

**Message Digest 5 (MD5)**  
Invented in 1992 by Ron Rivest and uses an 128 bit hash. It has the ability to generate collisions.  
A collision means that two different pieces of data will generate the exact same hash.
**Secure Hash Algorithm**  
Developed by NIS, and there is different types of it.  
* SHA-1: Have the ability to generate collisions and has 160 bit hash.  
**Collision based hashes are not used that often anymore because they can be hacked.**
Most commonly used and advance hashes:
* SHA-2: It is based on the length of the hash (SHA-256, SHA-512).
* RIPEMD: Not very common, but it is an open standard and it comes in 128, 160, 256, 320 bit digests.

**For the exam make sure we know the size of the hashes**  

## HMAC
HMAC (hash-based message authentication code) requires each side of the conversation to hace the same key and it is based on standards hashes (MD5,SHA-1,etc.).  
HMAC uses two passes of hash computation. The secret key is first used to derive two keys – inner and outer. The first pass of the algorithm produces an internal hash derived from the message and the inner key. The second pass produces the final HMAC code derived from the inner hash result and the outer key.

## Steganography
Is the process of taking data and hiding it within other types of data. Usually we take data and we hide it within images. There is different programs that can help us do that.

## Certificates and trust
A digital certificate is a document with a public key and a digital signature of the host and a digital signature of a trusted third party. That third party will generate a certificate to generate trust to other people that wants to connect to our website.

## Public Key Infrastructure
Is the real infrastructure that we use for every real world application that uses public key. 

## Cryptographic Attacks
**Password cracking:** All of the passwords in a Server, Database, Webserver, etc. Are stored in a form of a hash. So, if we want to start hacking passwords what we are typically trying to hack is a hash.  

1. First of all we need to get to those hashes and it is really the most big and important part. Once we hack the server and get all the list of username and passwords then we can start cracking passwords.  
2. We can't reverse a hash, therefore we will have to generate our own hashes until one matches with a hash on the list. Hashing attacks, are comparitive attacks, generated hashes vs sotred hashes.  

This attacks are done by **brute force** and the longer the password the longer is going to take the machine to crack it. **That is why we use always long and complex passwords**.

**Dictionary attacks:** A dictionary attack is performed when we assume that the password we want to crack might have some words in combination with other numbers or characters. Then, we write in a file (Dictionary) those possible words we think the password might have and we try them along with different other patterns or just by themselves (it still is a bruteforce but with some assumptions).  

**Rainbow-table attack:** If we need to crack some very complex passwords and we need to improve our timing issues we are going to use this type of attack. Those are nothing more than a pack of a lot of hash tables in order to compare against the hashed password we want to crack and try to discover it.

**Key stretching:** It is more powerful than a hash and a salted hash, and it is pretty much uncrackable nowadays if everything is well done. One key stretching technque is called **bcrypt**. 

# Identity and access Management <a name="identity_access_management"></a>

## Identification
There is different types of authentications:
1. Something you know.
	* Passwords,pincodes,captcha and security questions.  
	2. Something you have.
		* Smart Card (chip with id), rsa key.
		3. Something about you.
			* Fingerprints, facial recognition, etc.
			4. Something you do.
				* The rythm of your typing style to identify an user.
				5. Somewhere you are.
					*  Has to do with geolocalization in order to track an asset like a credit card or cellphone.

					**Multifactor authentication:** Using two or more authentication methods in order to gain access to an asset or system.

## Authorization concepts
Once we are authenticated, it is very important to define what tasks can a user do or not do.

**Permissions:** Are applied to resources.
**Rights and privileges:** We tend to assign at system level.

**Least privilege:** It is a concept that gives to a user only the minimal rights and privileges in order to get the job done.
**Separation of duties:**

## Access control List
The access control list or ACL is nothing more than a List with all of the types of rights and permissions for different kind of users.  

### Authorization Models
* Mandatory access control (MAC): Get some kind of resources and put Labels on them. This way, only the users with permissions to the specific labels will be able to access.

* Discretionary Access Control (DAC): The owner of the data decides who has access to it and the different rights and privileges to each user.

* Role-based Access Control (RBAC): Based on the role we apply different rights or permissions.

## Password Security
In order to start choosing save passwords we are going to write a **good Security Policy**, so we can keep it in mind every time we choose a new password. Also, it has to include the following: 

* **Complexity**
	* Length and character requirements
	* **Expiration**
		* Reset and time triggers
		* **Passwords history**
			* Reusage and retention

			**Local Security policy:** These are the set of policies declared on a local OS in order to secure passwords (Change passwords after 120 days, minimum password length, alphanumerical password required, 5 incorrect password attempts before getting locked).

			**Group policy objects:** Same as local security policy but it can apply to an entire directory. Therefore we can use it to setup some security policies inside a network of computers.

## Linux File permissions
The first value of the permissions of a linux file or folder it is going to determine wheter it is a directory (d) or file (f).  

The next values are going to be the permissions of that file or directory in order to read, write and execute fot three different types of users: 1.Owner, 2.group, 3.Everyone.

**Ex:** drwxrwxrwx chemistry.pdf

**r** = read (Open a file, view contents)
**w** = write (Edit a file, Add or Delete Files)
**x** = execute (Run a file, CD to a different directory)

The main tool we use in linux to change user permissions it is called **chmod**.

`chmod o= rw- FileName` (Change permissions for other, everyone)

We can use **o** for Everyone, **g** to change group permissions, **u** for owner.

Also, there is an old school way of using chmod based in a binary system:

Decimal | Binary | Permissions
--- | --- | ---
0 | 000 | ---
1 | 001 | --x
2 | 010 | -w-
3 | 011 | -wx
4 | 100 | r--
5 | 101 | r-x
6 | 110 | rw-
7 | 111 | rwx


`chmod 777` (gives everybody read, write and execute permissions).  
`chmod 720` (gives owner all permissions, write for grup and non for others).

In order to change the user ownership of the file we are going to use **chown**.

`sudo chown root *FileName*` (changing the user owner to root)

In order to change user passwords we use **passwd**.

`sudo passwd` (change current user password)

## Windows File Permissions
The best way to implement the permissions in windows is to create users and grups. Then, instead of given different permissions to an individual user. We can activate the permissions we want for the whole group and all the users of that grup will be influenced by those **NTFS permissions**.  

**Concept of Inheritance:** If you create a folder inside a directory with some NTFS permissions. That new folder will inherit all of the permissions from the parent directory.  

**Deny checkbox:** Turns off inheritance  

**NTFS Permissions**  
	* Full Control (you can do anything you want)
		* Modify (Read, write and Delete Files and Subfolders)
			* Read/Execute (See contents and run programs)
				* List Folder contents (See contents of folders and subfolders)
					* Read (View contents and Open data files)
						* Write (Write to files and create new files and folders)

						**Copying and Moving NTFS Objects**  
							* Copy from drive B -> C: Will take on the NTSF properties of the destination drive.
								* Move from drive B -> C: Will take on the NTSF permissions of the original drive or directory.

## User account Management
**Continuous access monitoring**    
We should be monitoring every single move our users are doing to have an idea of what is goin on on our infrastructure.
	* Track log on/log off activity.
		* Track file access.

		**Shared accounts**  
		That is a really bad thing, never do sharing accounts.  

		**Multiple accounts**  
			* Use different username and passwords to different accounts.
				* Monitor which users belong to which groups.
					* Use least privilege - enough necessary to acomplish task.
						* Monitor and log activity of users with multiple acounts.  

						**Default accounts**
							* Use dedicated service accounts, that way you can know who is doing what.

## AAA
Triple A, means Authentication, Authorization and Accounting. There is two ways to do that:  
	* Remote Authentication Dial-In User Service.
		* Terminal Access Controller Access-Control System Plus.  

		**RADIUS:** it is used in wireless authentication.
			* Radius is used for network access mainly.
				* Radius can use up to 4 different ports: 1812,1813,1645,1646.  

				**TACACS+:** Decouple the authorization from the authentication.
					* It uses TCP port 49.

					**Both TACACS+ AND RADIUS do auditing for log files**

## Authentication Methods

**Password Authentication Protocol (PAP):** The oldest authentication method. PAP sends username and password in the clear to authenticate. Very bad practice we don't use it anymore.  

**Challenge-Handshake Authentication Protocol (CHAP):** It uses hash values to authenticate an user.  

**NT LAN Manager:** It uses hashes and key authentication to challenge the client and the server against each other to verify that both have the same key.

**KERBEROS:** It is used to authenticate windows domain controllers. It listens on port 88 for stuff to happen.  

**SAML - Security Assertion Markup Language** - It is used exclusively for web applications. Very powerful tool.  
**LDAP - Lightweight Directory Access protocol** - Structured language that allows one computer to go inside someone else directory and query, updated, etc. Uses **tcp and udp port 389**.  

## Single Sign-on
You signed in once to one computer and you have access to all of the different computers on the network.  

**Local Area Network (LAN)**  
	* Uses windows Active Directory.
		* We have a windows server which is going to have a window domain, and all the other computers on the network will have to join that domain in order for the admin to monitor all of them (**Federated system**).  

		**Security Assertion Markup Language (SAML)**  
			* It is used to manage multiple apps using a single account and interact with other servers or devices like: login webapps, cameras, lights, etc.

# Tools Of The Trade <a name="tools_trade"></a>

## OS Utilities
**ping:** We use ping to send a request to another server to see if everything is working right (recieves and responds to request). **Ex:** `ping www.google.com`. Sometimes if we get an ipv6, we can force it to connect on ipv4 with `ping www.google.com -4`.  

**netstat:** Prints information about the linux networking subsystem. If we need to know what sessions a particular host is running at  every given moment this is our tool.  
	`netstat -n` (check which network connections my system is establishing)  
		`netstat -a` (show me all opening ports including the ones not connected)  

		**traceroute:** The traceroute command maps the journey that a packet of information undertakes from its source to its destination. One use for traceroute is to locate when data loss occurs throughout a network, which could signify a node that's down. `traceroute www.google.com`  

		**arp:** manipulates the System’s ARP cache. It also allows a complete dump of the ARP cache. ARP stands for Address Resolution Protocol. The primary function of this protocol is to resolve the IP address of a system to its mac address, and hence it works between level 2(Data link layer) and level 3(Network layer). `arp -a` (hostname).  

		**ip or ifconfig:** Take a look at your network system `ip addr`.  

		**nslookup or dig:** command allows you to display information that you can use to diagnose Domain Name System (DNS) infrastructure.  

		**netcat:** can open and listen to ports, and can be an aggressive tool for reconnaissance.

## Network Scanners

**nmap:** is a free and open-source network scanner used to discover hosts and services on a computer network by sending packets and analyzing the responses. 
Example -> `nmap --top-ports 20 192.168.1.106`

## Protocol Analyzers
The tools that we use to analyze the network traffic coming in and out of a specific host computer.  

**wireshark:** Allows us to filter the data by services and protocols and there are two seperate pieces for every protocol analyzer:  

	* Sniffer (captures all data coming in/out of a particular interface).
		* Analyzer (analyzing the data)

		Looking at a network analyzer we can look closely at an activity taking place with that session.

## SNMP - Simple Network Management Protocol
In an SNMP Network, there is a Managed Device which has an agent (software from the factory) that allows us to connect with the SNMP Manager to controll it. That is called a **Network Management Station**. The connections are made via UDP port 161 or TLS 10161 if encrypted.  

**Management Information Based (MIB):** It is a database that has the Managed Device in order to know the functions that can do when told.

**Network communications**  
	* Get: We send some information to the device and it provides a response.
		* Trap: It is setup in the Manage device itself and if the action happens, the device will send information to the NMS.
			* SNMPWalk: Send a lot of get requests in a big batch.  

			**SNMP Version 1 does not support encryption**  
			**SNMP Version 2 added basic encryption**  
			**SNMP Version 3 added TLS encryption**  

## LOGS
**Non-Network Events**  
	* Events that happen on a host even though it's not connected to a network. Mainly OS events or Apps running on the system.

	**Network Event**  
		* Events that deals with the communication between the host and something on the network.
			

# Securing Individual Systems <a name="securing_individual_systems"></a>
We are going to learn different attacks hackers can use to penetrate your system and how to defend them.  

## Denial of Service 
The whole idea behind this attack is to deny a service, in order to do that we try to connect as many people as we can to a server until it collapses and can't handle anybody else.  
### DOS Attack types  
* **Volume attack**
	* We try to overwhelm the machine sending a lot of requests.  
		* **Ex:** Ping flood, UDP flood.

		* **Protocol attack**
			* It is performed by sending a lot of SYN packets to the server until the last one doesn't respond anymore and it is the most common DOS attack we have today.

			* **Application attack**
				* We take advantage of some problem happening inside an application.
					* *Slow Loris Attack* is an example in which we keep sending requests to a server but not responding them. 

					* **Amplification attack**
						* *Smurf attack*, sending an ICMP packet to server is going to do a lot of other systems connected to the network communicate with the original server to see what is going on (we amplify a request).  

						* **DDOS - Diistributed Denial of Service Attack**
							* A lot of computers infected by Malware, *Zombies*, send a lot of requests at the same time to a Server. These are called *BotNets* and they are controlled by a single computer.  

## Host Threats
**Spam:** Unsolicited email from third party services.  
**Phishing & Spear fishing:** Unsolicited email from individuals with malicious intent in order to get some kind of private information from a person.  
**Spim:** Using instant messaging to spam.  
**Vishing:** Spam trying to get private information via phone calls.  
**Clickjacking:** Malicious clickbait links on the internet.  
**Domain Hijacking:** People steal your domains and they ask a lot of money from you to get it back.  
**Privilege Escalation:** Get more privileges in a system in order to do evil or malicious stuff.   

## Man in the Middle
A man in the middle (MITM) attack is one where the attacker (in our example, Mallory) secretly captures and relays communication between two parties who believe they are directly communicating with each other (in our example, Alice and Bob).  

![alt text](https://witestlab.poly.edu/blog/content/images/2016/03/mitm-illustration.svg)  

### How to perform an MITM attack with ARP spoofing over a wireless network  

1. Setup ip forwarding on KALI Machine.
	The ip_forward file is set to 0 by default and we have to change it to 1.  
		 The ip_forward file is set to 0 by default and we have to change it to 1.  
			`echo 1 > /proc/sys/net/ipv4/ip_forward`  
			2. Know our default gateway or ip address of our router.  
				`ip route`
				3. Know the interface on which we are going to perform this attack.  
					`if config` (in our case is wlo1)  
					4. Start the attack with arpspoof.  
						`arpspoof -i [interface] -t [ipTarget] -r [defaultGateway]`  
						5. Sniff information with Wireshark.  

						[See More complex example](https://www.youtube.com/watch?v=7PqMPhItKPM)  

## System Resiliency
It is the ability to defend a system from a possible incident that may happen.  
**Scalability and Elasticity:** If the webserver starts to get a lot of requests, we are going to need more servers ready in order to prevent a crash. Also, if we know that a particular day we are going to have a lot of traffic coming through our website is good to have the ability to scale and reduce servers as we need.  

**Redundancy:** Is a form of distributive allocation. Ex: Distributing servers around different places in the US.  

**Non-persistence:** Data that is collected but will not be saved on restart.  
**Examples:** Backups, Systems Snapshots, updates removal ... 

## RAID - Redundant Array of Independent Disks
* RAID arrays enable you to speed up data access, protect data, or both.  
* The most common RAID styles includes 0,1,5, & 10.  
* RAID 1 & RAID 0 requires at least 2 drives, RAID 5 requires 3 or more drives, & RAID 10 requires 4 drives.  

## NAS AND SAN
Those two technologies are designed to store data. They have dedicated systems that only share data.  

**Network attached storage:** File-level computer data storage server connected to a computer network providing data access to a heterogeneous group of clients. NAS is specialized for serving files either by its hardware, software, or configuration.  

**Storage area network:** A Storage Area Network (SAN) is a specialized, high-speed network that provides block-level network access to storage. SANs are typically composed of hosts, switches, storage elements, and storage devices that are interconnected using a variety of technologies, topologies, and protocols. SANs may also span multiple sites.

A SAN presents storage devices to a host such that the storage appears to be locally attached. This simplified presentation of storage to a host is accomplished through the use of different types of virtualization.

## Physical Hardening
### Removable media control
Optical media can be very dangerous as someone could insert some evil CD into your computer and load some malicious software into the system. Fortunately for us, we can configure our systems to control what the optical media system can and can't do. There is different ways to set this up on different OS and we can set it up to not work for the whole OS or just banned some particular users.  

### Data Execution Prevention (DEP)
DEP is a security feature that can help prevent damage to your computer from viruses and other security threats. Harmful programs can try to attack Windows by attempting to run code from system memory locations reserved for Windows and other authorized programs.  

### Disabling ports
In order to do that we are going to disable the ports through the UFI BIOS of the computer. In the peripherals window we can disable the USB ports and almost every port in our computer.

## RFI, EMI and ESD 
### Radio Frequency Interference & Electromagnetic Interference 
Radio radiation and Electromagnetic signals can cause some interference on our systems. That's why we should always connect them in different circuits or separate them so there is no interference at all.

### Electrostatic Discharge 
We can suffer from a Discharge if there is an over power circuit. So always use wrist band circuits and materials in order to prevent that to happen. Also, it is very important to use the right voltagees to power electronic equipments.  

## Host Hardening
### Disabling Services
Disabling unnecessary services that we don't use on our system is one of the good practices of a good system administrator. As, some malicious people can get into your system through those open services.  

### Default passwords
It is very important to not use default passwords as bruteforcing cracking lists can discover those very quickly. Not only on the OS, change all default passwords on routers, ip cameras, devices...  

### Disabling unecessary accounts 
If we don't use an account anymore just delete it and it will avoid one more way for people to hack into it.  

### Patch Management 
1. Monitor: Always keep up to date for the new patches that are coming out for OS, software, hardware ...
	* Might not get reminders.
	2. Test
		* Deploy the system in sandbox environment to test if the patch works good first.
		3. Evaluate 
		4. Deploy patch
			* Watch for scheduling issues.
			5. Document
				* Always document all of the changes that we are going to make in all of the computers we manage.

### Anti-malware 
Always make sure we have an alti malware installed on our computer and up to date with all the possible attacks that might happen.  
* Training for our users
* Procedures 
	* Teach best practices for users and they have to learn how to detect malware if it happens.
	* Monitoring
		* Watching our security logs, dns, IDS (Intrusion Detection System can help detect threats to the hosts).
			* But if we want to get serious about it is better to get a Third-party anti-malwere.

### Firewall
Every computer in our network should have a firewall. Many corporations have a whitelist and a blacklist of applications you can and can't install and use for security reasons.  

## Data and System Security 
1. Always make sure we have data integrity, like backups so if something happens to our system we don't lose that data.
2. Speed/quick access.
3. High availability.

**RAID** it is a grate way to secure data and it is fairly cheap. The only disadvantage is that if the OS blows up we are going to lose the data.  

**Clustering** you have a lot of computers sharing the data and if one dies, you don't lose the data because another computer will have it.  

**Virtualize a server** is a really good option to secure data because we can save a snapshot of the system and if something goes wrong we can always go back to the previous update.

## Disk Encryption
Encrypt the data that is stored in our massed storage, but this is going to slow down your system.  
**Recommended on:**  
* Mobile and portable devices (Laptops, smartphones,tablets).
* Desktop systems with limited security.  

Disk encryption can be broken into two groups: *TPM & NON-TPM*.  
Two examples of disk encryption programs are *BitLocker* and *FileVault*.  

## Hardware and Firmware Security

### Full Disk Encryption (FDE)
It is a methodology to encrypt all our mass storage to secure our Data. *BitLocker* is a software that we can use in a Windows OS to encrypt a full Disk.  

### Secure Boot
Checks the performance of every hardware, software and firmware every time we log in to a system to check performance and possible errors in order to boot up.  

### Hardware security module
It is a piece of hardware that takes care of the sign in on your system.

## Secure OS Types
1. Server OS.
	* Bulit-in functionality.
		* Connections.
		2. Workstation.
			* Desktop version (Windows 10, Ubuntu, MacOS).
				* Workhorse.
				3. Embedded systems.
					* Appliance.
						* Own OS.
						4. Kiosk.
							* Limited function (Small versions of linux most of the time).
							5. Mobile OS.
								* Apple.
									* Android.
										* Mobile devices Operating Systems.

										**In order to choose one of those types of Operating Systems always go with the one who has the least amount of functionality but enough to perform their job.**  

## Securing peripherals

### Wired vs Wireless peripherals
**Bluetooth**  
* *Bluejacking* is the idea of connecting into a Bluetoth device.
* *Bluesnarfing* means connecting in to a bluetooth device to steal data.  
In order to prevent that if you don't use bluetooth simply don't enable it in your device.  

**WPS**  
It is a technology that allows to connect to the router pressing a single button using wpa2 encryption.  

**Hidden Wi-fi**  
Sometimes printers and other devices have SD slots to store information. But there are different types of SD cards an not all of them are used to store data. There is SD wifi cards which are perfectly fine for someone to use it as a normal connection and steal data from all the new user who connect to it.  

**Displays**  
USB ports in displays can become a big problem as some evil person can plug a *Rubber Ducky* and steal a lot of information displaying on the screen.  

**Turn off non necessary ports for security and make sure always keep up to new updates and patches**  

## Malware 
Malicious software that is running on the background of your system without you knowing about it.  
**Virus:** Piece of software that gets into your computer through hardwere or internet.
* It will attach to other files.
* Will propagate.
* Spread to other devices.
* Activate.  
**Adware:** Programs that try to put adds on your computer like: pop-ups, links, etc.  
**Spyware:** Some form of malware that is hidden from you (we don't see it), but it is spying your system one way or another. Ex: seeing connections, what you type, camera, files, etc.  
**Trojan Horse & RATs:** Software running on your system that is doing something nice, but is running a malicious piece of code on the background.  
**Remote Access Trojans (RATs):** Trojan but it is controlled remotely and the evil person can turn it on and off.  
**Ransomware/Cryptomalware:** Type of malware that locks your system in some way that you can't get into it until you pay the evil people some money and they unlock it for you.  
**Logic Bomb:** Program that is sitting on a computer until is triggered by an event.  
**Rootkit:** Software that escalates privilages to execute other things on computer.  
**Backdoor:** Software that allows you to log in to the system remotely.
**Polymorphic malware, Keylogger & Armored Viruses:** Polymorphic malware changes itself, armored viruses are hard for anti-malware to detect, Keylogger collects information of the keys entered in a computer.  

## IDS and IPS
Inside a network the first line of defense is going to be a firewall. And it's job is to prevent naughty things from the outside world coming in to our network. But, firewalls are not perfect and sometimes some malicious staff make it through the firewall and that is why we need another layer of protection after the firewall. That is when **Intrusion Detection Systems** come into play.  
**IDS:** Stays inside the network, watches within the network traffic and sends alerts on suspicious activity.  
**Intrusion prevention system (IPS):** Active IDS, looks inside the network for naughtiness like an IDS but the IPS is going to do something in order to stop the attack.  

**A firewall filters, an IDS notifies and an IPS acts to stop.**  

## Automation Strategies 
Automation gives us the ability to repeat consistenly something for us every time.  

## Data Destruction and Media Sanitation
**Clearing:** Deleting data with an internal command to make the data go away. **Ex:** Delete, erase, format.  
**Wiping:** Wiping programs will start to write 1 and O from the beginning of the drive until the end of the drive. Therefore, we are completely destroying the data. But, we will be able to use the hard drive for something else.  
**Purge:** To do something to the device externally to make data go away. **Ex:** Degausser (Machine with a very strong electromagnetic field that will delete all the data as well as destroy the drive).  
**Destroy:** Run the media in such a way that is no longer functional.  
	* Burning the drive.
		* Pulping (put it in to water).
			* Shredding machine.

# The Basic LAN <a name="the_basic_lan"></a>

## LAN Review
LAN = Local Area Network.  

### Switches
Switches filter and forward data based on MAC addresses (Layer 2). And we are going to review some of it's most important concepts.  
1. **VLAN:** provides layer 2 separation of networks and we can have multiple VLAN in a switch and specify which ports we want to use for that specific Network. With VLAN we can create separate networks from a single switch.  

2. **STP (Spanning Tree Protocol):** We enable STP or RSTP in a switch in order to prevent loop floods. 

### Routers
Routers filter and forward information based on IP adresses (Layer 3) and they are going to act as the gateway or interface between different network IDs.  

## Network Topologies Review
A network topology is the organization of a network in terms of how is the data moving around that network.  
**LAN:** A bunch of computers connected to a Broadcast Domain or Switch.  
**WAN (Wide Area Network):** At least two LANs connected together and at least one router.  
**MAN (Metropolitan Area Network):** A bunch of WANs that are connected together throughout a city.  
**TCP/IP:** Protocol that runs the internet.  
**Intranet:** Private network which still runs on TCP/IP.

## Network Zone Review
**DMZ (Demilitarized zone):** It is a secure way to structure all of our systems in a organization and the structure is the following:                              
LOCAL AREA NETWORK -> ROUTER + (FW) -> WEB,FILE,VPN SERVERS -> GATEWAY ROUTER + (FW)-> INTERNET  
**FW** = FIREWALL  
**Wireless Networks:** Plugin a ethernet cable from our main switch in a LAN to a Wireless access point (WAP), is going to provide us with a zone with access to that LAN wirelessly.  
**Guest Network:** It is always going to run in a separate VLAN and it is designed and protected for guests to not be able to access any information of the network.  
**Virtualization:** Creating a LAN network with virtual computers.  
**Airgap:** Disconnection between networks to provide full isolation.  

## Network Access Controls
**Point to Point Protocol (PPP):** The first internet protocol with very weak authentication.  
**EAP Extensive Authentication Protocol:** A framework which was developed as an extension to improve the authentication of PPP. It has different methods: *EAP-MD5, EAP-PSK, EAP-TLS, EAP-TTLS*.  

## The Network Firewall

**Stateless Firewall:** It is going to block connections for a specific address, ip, port, conexion, etc. And it is going to be specified in a file called Access Control List.  
**Stateful Firewall:** Looks at what is going on and then makes a decision of what is going to do. It is based on behavior more than rules.  
**Application-based firewall:** Usually used to protect servers (designed to protect single applications).  

## Proxy Servers
A Proxy is a box/piece of software running on a computer which acts as an intermediary between two different devices having a session. Proxy is application specific, so there is Web proxy, FTP proxy, Vo1p proxy, etc. There is two kinds of proxy servers: *Forward proxy servers* and *Reverse proxy servers*:  

* **Forward proxy:** In this case the client speaks to the proxy and the last one establishes communication with another server.  
**Ex:** CLIENT -> **PROXY** -> FIREWALL -> INTERNET -> SERVER  
There is also a **modern forward proxy** that is used for people who want to be more anonymous and it connects to a proxy through the internet (that proxy can be in another state or country).  
**Ex:** CLIENT -> INTERNET -> **PROXY** -> FIREWALL -> SERVER (in this case if we want it even more secure, we can encrypt our communication from the client to the proxy with a **VPN**).  

* **Reverse proxy:** This server is specific for web servers or servers in general, and the proxy protects the main server from possible DOS attacks, it is also used for load balancing (if you have more than one server will balance the information through all of those), Catching, encryption acceleration.  
**Ex:** SERVER -> **PROXY** -> FIREWALL -> INTERNET -> CLIENT

## Virtual Private Network 
VPN directly connects into the network from a remote location, fully functional.  
**Connection Options for VPN**  
* Leased Line (cable) and it is very expensive.
* Via public network, virtualized (internet). 

**VPN Tunnel:** Connection between two VPN endpoints.  

* There is two types of VPNs: **remote access** and **site to site**.

## IPSEC
Internet Protocol Security is a secure network protocol that authenticates and encrypts the packets of data to provide secure encrypted communication between two computers over an Internet Protocol network. It is used in VPNs.  

Ipsec runs in two very different modes: 
1. **Authentication headers:** It only provides integrity, it adds an Authetication header to the packet before sending it (HMAC). 
2. **Encapsulating Security Payload:** It encrypts the packet before sending them and also adds the authentication header.  

* If we keep the original IP adresses, we are using **transport mode** and does not work very well in the real world that is why we use **Tunnel mode**.  
**Tunnel mode:** we replace the original IP for a new one in the packet. It is commonly used with ESP as well, injecting the new IP adress as a header in the encrypted packet.  

**IPSec Protocol Suite**  
* Uses negotiation protocol **ISAKMP**.
 * Initial authentication.
   * Certificates.
     * Preshared keys.
	   * Key Exchange.
	     
		 **IPSEC is commonly used in VPNs and there's used in two ways: Pure IPSEC and IPSEC with L2TP**  

## NIDS/NIPS
This means Network Intrusion Detection/Prevention System. Detection means that it alerts somehow of an intrusion. Prevention instead, detects if something is happening but also tries to stop it one way or another.  

### NIPS Detection
* Active.
 * Blocks from router.
 * Detection methods.
  * Behavioral/anomaly.
   * Signature-based (Pre-made instructions).
    * Rule-based.
	 * Heuristic.
	   * Combines anomaly and signature.
	     
## SIEM 
		 Security Information and Event Management, it is a type of software that is going to help us monitor all of our network to check the performance.  

# BEYOND THE BASIC LAN <a name="beyond_the_basic_lan"></a>
**SSID** is associated to the MAC address on a wireless access point and is know as a **BSSID**.
## Wireless Review
These are the main Wirless Infrastructure modes sorted by oldest methods to more modern ones:  
1. **802.11 Infrastructure mode**
  * It has no authorization and no encryption.
  2. **Wired equivalent privacy (WEP)**
    * Provides basic authentication and encryption.
	  * Based on RC4 streaming protocol.
	    * Generates and Shares key of 64bit or 128bit to connect with clients.
		  * WEP can easily be **hacked**.
		  3. **Wireless Protected Access (WPA)**.
		    * In order to create a strong authentication they created **802.11i** standard.  
			  * It incorporates the **802.1X** authentication.
			    * Connection with username and password.
				  * They use a very strong and robust **AES encryption**.
				    * We can always use PSK or pre-shared keys.  
					4. **WPA2**
					 * It is going to be completely 802.11i standard which uses 802.1.X and AES encryption.

## Living in open Networks
Open networks are very practical because they provide us quick access to the internet, but they are very dangerous because they are also insecure. They are a big problem because evil people can capture and steal data and information. **Ex:** stealing cookies (SSL Stripping), sniffing packets.  

**What do we do to prevent that ??**  
* Use **secure protocol** on unsecure wireless networks.
* Use **https** on Web sites that collect information.
* Use VPN in non-secure web environments.  

**HTTP strict transport security (HSTS):** Servers automatically redirect you to their Secured website instead of http.  

## Vulnerabilities with Wireless Access Points
**Rogue access points:** It is an unauthorized access point.  
**Evil Twin:** Creating another access point with the same SSID of the AP we want to attack and then get the credentials from the user who wants to log in with a false authentication pop up.  
**Deauthentication attack:** We can see all the clients connected to an Access Point and with these tecnique we can deauthenticate a client from a specific Network in order to get them connected to our Evil Twin network.  

## Cracking 802.11 (WEP)
Cracking WEP, WPA, WPA2 and WPS:  
**Cracking WEP**  
WEP initialization vector is vulnerable to cracking and we can crack it with an **IV attack**. What these attack does is getting the password by analyzing a lot of packets. We are going to use Aircrak tool to grab WEP keys.  

1. `airmon-ng`
 * Check what kind of network cards I have.
 2. `airmon-ng start [interface]`
  * Start the network card.
  3. `airodump-ng [interface]`
   * Start monitoring the wireless networks around the area.
    * Grab the wireless AP we want to attack.
	4. `airodump-ng -w dumpfile -c 6 --bssid [BSSID] [interface]`
	 * Grab the specific packets that we asked about and dump it on that file.
	  * Let it run about 5 to 10 minutes.
	   * We can see systems that are making connections with the AP.
	   5. `aircrack-ng [dumpfile.cap]`
	    * HACKING DONE and hopefully you Decrypt the key correctly.  
		 
## Cracking 802.11 (WPA)
		 WPA is very difficult to crack because it has a very strong encryption and it is very difficult to decrypt. There is other methods to crack WEP and a very famous one is a **dictionary attack**. WPA/WPA2 can be cracked at the initial connection between the WPA/WPA2 client and the access point during the 4-way handshake.  

		 1. `airodump-ng [interface]`
		 2. `airodump-ng -w wpafile -c [channel] --bssid [BSSID] [interface]`
		  * Monitor for people to connect to the AP to get Handshakes.
		  3. `aircrack-ng -a2 -w dictionaryFile wpafile-01.cap`
		   * -a2 is WPA2 cracking mode.
		    * dictionaryFile contains a bunch of possible passwords.
			 * wpafile-01.cap is the file which has the handshake that we want to crack.  
			  
			   **Always use long, complex private shared keys when dealing with WPA and WPA2 in order to prevent bad people to easily discover your password**  
			    
## Cracking 802.11 (WPS)
				WPS is a push button configuration and it has several weaknesses:  
				* 8 digit key is actually only 7 digits 2^7.
				* Key exchange is the first processed in 4-bit and 3-bit.
				* The key or pin used in WPS is very weak.

				1.`reaver -i [interface] -b [BSSID]`
				 * Cracking wps  

				 **WPA Attack Prevention**  
				 * Get rid of older routers.
				 * Firmware updates. 
				 * Upgrade to newer wireless router.  

## Wireless Hardening
**Hardening 802.11 Networks**  
1. **Survey installation issues.**
 * Survey tools are going to help us to setup and install our network.  
 2. **Maintaining existing wireless networks.**  
  * Keep a good Documentation.
    * SSIDs.
	  * MAC addresses associated to: WAPS, AP locations, Heatmaps.
	    * Disable Wireless SSID Broadcast.
		  * AP Isolation.
		    * Make Long Passwowrds.
			  * Periodic Scanning.
			  3. **Monitor wireless networks**
			   * WIDS - Wireless Instruction System (very important to have).
			     * Monitor wireless radios.
				   * Watches for rogue access points.
				     * Knows MAC address of authorized equipment.
					 4. **Define how to defend wireless clients.**
					  * Trained clients are an essential part of good wireless security.  

## Wireless Access Points
There's different kinds of access points and we want to make sure we pick the right one for every different situation:  

**Thick client:** Big powerful WAP for corporations mostly and we have to configure every client individually.  
**Thin client:** Are configured through a controller and make it easier to configure multiple units.  

**WAP Antenna Types**  
* **omni:** The signal goes to every possible direction (installed outdoors).
* **dipole:** They are useful to cover floors or spaces at the same level  \|/ .
* **directionals:** There is yagi and parabollics.
* **patch:** Patches are usually mounted on a wall and they only shoot one direction.   
**Band Selection**  
The 802.11 standard has two different bands: 2.4 or 5 GHz band.  

## IaaS 
Infrastructure as a Service, simply means that some company rents you some computers with your specific needs for you to use. It is very convinient because you don't have to pay for expensive computer parts and set them up. **EX:** Amazon Web Server, Digital Ocean, Microsoft Azure, etc ...  

## PaaS
Plataform as a Service is ideal for developers, they can create their own applications and deploy them without the need to worry about seting up any infrastructure at all. A very popular platform is called **HEROKU** and it is going to deploy our project in less than a minute with a simple command line.  
## SaaS
Software as a Service is a subscription based license that allows you to make use of that specific software. **Ex:** Adobe Creative Services, Microsoft Office 365, Dropbox, Google Docs.  

## Deployment models 
1. **Hosted application:** Physical servers installed and setup from scratch to serve web servers or different kind of applications.  
2. **Cloud:** These are servers which we can access remotely. On a **Private Cloud** we are going to be the only ones to access those servers (We have to setup a bunch of VMs). On the other hand, a **Public Cloud** is going to be a bunch of servers from Amazon or a third party which are available to rent to anyone for a certain time.  
3. **Virtual Desktop Environment:** accessing a remote physical desktop. 
4. **Virtual Desktop Integration:** actual virtualized environment in the cloud.  

## Static Hosts
Static Hosts are all the external devices that are conected t oa network like: printers, ip cameras, Access points, etc. Those devices are very important to an organization and it is essential that we keep them secure at all times.  

**Securing Static Hosts**  
* Change default passwords.
* Turn off unnecessary services.
* Monitor security and firmware updates.  
* Secure using Defense in depth concepts. 

**Remember for the exam**  
* Treat static host like regular hosts.  
* Use Network Segmentation to help protect static hosts.  

## Mobile Connectivity 
**SATCOM:** Satellite communication on smart phones.  
**Bluetooth:** Blue jacking and Blue snarfing.  
**Near Field Communication (NFC):** Very short range wireless connectivity, not secured when activated.  
**ANT:** Simple form of wireless communication, slow but well protected and it is usually used with odomoters, heart-rates monitors.  
**Infrared:** Usually cell phones have built in transmitors not recievers.  
**USB:** USB on the go is a technology that can connect normal usb to smartphones with a small adapter and that can cause some danger.  
**Wi-fi Direct:** It uses ad hoc mode and it is used to connect two devices easily together. The downside to this technology is that it uses WPS mode and we already know that it is very easy to hack.  
**Tethering:** Using your phone to get internet access on Laptoop. Tethering is really convinient, but it's only secure when done via wire. Wireless Tethering (Hotspots) if used not properly configured you can let anyone connect to the internet through your phone. 

**Always setup password protection on your phone**  

## Deploying Mobile Devices 
* Mobile devices are prolific and very useful in both personal and corporate environments.  

**Diferent deployment models**  
1. Corporate owned, business only (COBO).
 * It is company owned and they decide what to do with that device.  
 2. Corporate owned, personally enabled (COPE).
  * Everyone has the same device and it makes it much easier to control devices.  
  3. Choose your own device (CYOD). 
  4. Bring your own device (BYOD).  

  * Consider mobile devices management for privacy and productivity.  

## Mobile enforcement 
**Sideloading:** Prevention of downloading applications to your phone from other placess than the googlestore or AppleStore.  
**Carrier Unlocking:** Unlovk a Phone locked by service provider.  
**Rooting/jailbraking:** Get root access in your phone and install custom firmware.  

## Physical Controls
1. **Deterrent Physical Controls**
 * Is designed to prevent bad guys from trying to actually ger in to your physical infrastructure.  
  * Outside lightning, alert signs, security guards.
  2. **Preventative Physical Controls**
   * Fences, Gates, Barricades, K Ratings, Locks.  
    * Cabling Distribution Systems.  
	 * Good Key Management.  
	 3. **Detective Physical Controls**
	  * Detect that something naughty is taking place.
	   * Alarms, Cameras, Motion detectors, Infrared detectors, log files.  
	    
## HVAC 
		HVAC systems control the temperature of the computers, servers or machines (air-conditioning systems).  

		**Infrared Cameras:**  These cameras look on the infrared range to control heat.  
		**Hot & cold aisles:** Systems to share all the cold air through the room in order for the servers not to overheat.  
		**Securing HVAC:** Always leave an air gap and use VLAN for isolation of the system.  

		**Make sure you always keep the server room cool and dry**  

## Fire Supression 
**Fire extinguisher classes**  
 * **A:** It is designed for ordinary solid combustibles like burning wood.  
  * **B:** Designed for flammable liquids and gases, like gas.   
   * **C:** Designed for energized electrical equipment.  
    * **D:** Designed for combustible metals.  
	 * **K:** Designed for Kitchens and that is for oils and fats.  
	  
	   **For a server room we are going to need a class C fire extinguisher specific for electrical equipment**  
	    
		 **Fire supressors**  
		  **Halon:** not very environmentally friendly.  
		   **FM-200:** It is the standard type of material for fire supression in server rooms.  
		    
# Secure Protocols <a name="secure_protocols"></a>
## Secure Applications and Protocols
			1. **SSH:** It's an encrypted application and it's used to log in into different servers and it exhanging a public and private key in order to authenticate.  
			2. **TLS (Transport Layer Security):** It is a protocol that creates an encryption layer between the servers and the client requesting to visit the website, fixing the non-encrypted HTTP.    

## Network Models
**OSI Model**  
1. Physical Layer.
  * Ex: Types of Cables to use.
  2. Data Link Layer.
    * Everything that works with a MAC adress.
	3. Network Layer.
	  * IP Adressees. Ex: Routers.
	  4. Transport Layer.
	    * Assembles and disassembles packets. 
		5. Session Layer.
		  * Actual conexion between two systems like TCP.
		  6. Presentation Layer.
		    * Used to convert data into a format that your applications can read.  
			7. Application.  

			**TCP/IP Model**  
			1. Network Interface.
			  * Covers all the physical cabling, MAC adresses, network cards, pretty much everything in terms of hardware.  
			  2. Internet.
			    * This Layer is for anything it has to do with an IP adress, for example a router.  
				3. Transport.
				4. Application.  

## Know your Protocols
**IP adresses**  
* IPV-4 -> **EX.** 172.16.254.1
* IPV-6 -> **EX.** 2001:0DB8:85A3:0000:8A2E:0370:7334 (128 bits)  

**Private IP adress**  
1. Any IP adress that starts with the number **10**.  
2. Any IP adress that ranges from **172.16 - 172.31**.
3. Any IP adress that starts with **192.168**.  

**Transport Protocols**  
* **TCP:**  Connexion oriented type of protocol (client sends request to server and server sends response), can send a lot of packages and it is how the internet works. 
* **UDP:** Connectionless (sends one packet to the server with no response).  
* **ICMP:** supports TCP and UDP protocols, handles ARP and ping.  

## Know your Protocols - Applications
**Internet Protocols**  
* **HTTP:** Using TCP port 80, it is for unsecure websites.  
* **HTTPS:** Using TCP port 443, secure websites.  

**Remote Shell**  
* **Telnet:** Using TCP port 23, very insecure.  
* **SSH:** Using TCP port 22, secure shell.  

**File Transfer** 
* **FTP:** File transfer protocol using ports 20-21, completely insecure.  
* **FTP/SSH:** Using FTP over a SSH conexion using port 22.  
* **FTPS:** Using ports 20-21, using TLS encryption and it is very secure.  
* **SFTP:** SSH File Transfer Protocol uses port 22. 
* **SCP:** Secure Copy moves files across systems uses port 22. 
* **TFTP:** Trivial FTP uses UDP port 69.  
* **NETbios:** Using port 137,138,139 but more modern ones use SMB(running on port 445).  

**Mail**  
* **SMTP:** Simple Mail Transfer Protocol, uses port 25 (sends mail to other people).   
* **IMAP:** Internet Message Access Protocol (recieves mail), uses port 143.  
* **POP:** Older protocol but quite popular, uses port 110.  

**Others**
* **DNS:** Domain Name System, uses port 53.  
* **DHCP:** Dynamic Host Configuration Protocol, uses UDP port 67/68.
* **SNMP:** Simple Network Management Protocol, uses UDP ports 161/162.  
* **LDAP:** Light Weight Directory Access Protocol, uses port 389.  
* **RDP:** Remote Desktop Protocol, uses tcp port 3389.  

## Transport Layer Security
**SSL:** Secure Sockets Layer was developed to establish secure conexions between two points.  
**SSL/TLS are used in HTTPS**  

## Internet Service Hardening

**DNS**: Runs in port 53 and is a nonsecure protocol.  
**DNSSEC:** Use public and private key to connect and prevent the spoofing of packets from an evil person.  

**Always use secure protocols**  

## Protecting your servers 
Because encrypting&decrypting consumes a lot of cpu usage and can easily burn one, we are going to need to take some measures in order to prevent that.  

**SSL Accelerator Card:**  These cards instantly encrypts & decrypts asymmetric encryption.  
**Load Balancer:** Distributes all the requests coming from a website to different web servers to improve the performance.  
**DDOS Mitigator:** will send out an alert to emergency response services which assist in traffic flow to the site under attack.  

## Secure Code Development 
**Waterfall Model**  
1. Requirements.
2. Design.
3. Implementation.
4. Verification.
5. Maintenance. 

**Agile Methodology**  
Agile and Flexibile methodology to get software out of the door.  

**DevOps**  
We include Development and Operations in a plan.  
PLAN -> CREATE -> VERIFY -> PACKAGE -> RELEASE -> CONFIGURE -> MONITOR -> PLAN ...  
* Secure Development Operations: 
 * Security automation tools.
  * Change management/version control.  
   * Baseline (Crytical Security Objectives).  
    * Consider immutable systems. 
	 * Infrastructure as code.
	  
	   ## Secure Deployment Concepts
	   1. Proper error handling is absolutely critical. 
	   2. Proper input validation.
	    * In case someone enters malicious code inside an email input or so. 
		3. Normalization.
		 * Stored procedures is going to prote ct databases.
		 4. Encryption/code signing.
		  * We digitally sign our code.
		  5. Obfuscation.
		   * Using minifiers to make our code difficult to understand and rerse enginer.
		   6. Reuse Code and get rid of dead code.
		   7. Server-side vs. client-side execution.
		   8. Memomry management. 
		   9. Be careful with third party library vulnerabilities and keep them always up to date.  
		   10. Data Exposure, our jobs as developers is to reduce the exposure of code or private information so: use lots and lots of encryption.  

## Code quality and Testing 
Once your code is developed, the first thing you are going to want to do is test your code.  
**Static code analyzers:** they look through the code and find standart type of errors that often developers do. It just reads the code doesn't run it.  
**Dynamic code analysis:** It actually runs the code in order to find logic errors, security holes, typing in SQL injections, memory leak...  
**Staging:** Start to create more and more realistic world environments to see how your code performs in thos kind of situations.  
**Stress test:** Do a test to see if there's a memory leak or if the databases can keep up, etc.  

# Testing your Infrastructure <a name="testing_infrastructure"></a>
## Vulnerability Scanning Tools 
Vulnerability assessment is an action we do and we use vulnerability assessment tools to actually go about that process.  

**Tracert:** It is a simple tool but it's going to give us a lot of information about the network and we can use that as a tool to be part of our assesment.  
**nmap:** Port scanner and network analyzer tool.  
**Microsoft Baseline Security Analyzer:** Microsoft tool that will help us to see if we are up to date in our system and it's going to perform a vulnerability assessment.  
**Vulnerability assesment tools for entire infrastructure:** Nessus, Nexpos, OpenVAS.
* Management determines when vulnerability scanning is done.  
* Misconfigurations often are vulnerabilities.  
* Vulnerability scanners can be configured to scan against different databases or rule sets.  

## Social Engineering Principles 
Social engineering principles are focused more on people's behavior as apposed to their physical actions.  
1. **Authority:** To impersonate or imply a position of authority.  
2. **Intimidation:** To frighten by threat.  
3. **Consensus:** To convince of a general group agreement.  
4. **Scarcity:** To describe a lack of something.  
5. **Trust:** To assure reliance on their honesty and integrity.  
6. **Urgency:** To call for immediate action.  

**Never give to anyone private information**  

## Social Engineering Attacks 
**Phishing:** Emails that are used to steal personal information.  
**Spear-fishing:** Phishing that is directed to a specific person or company.  
**Whaling:** Spear phishing that targets senior management and executives.  
**Vishing:** Uses the telephone system to get private information.  
**Hoax:** Warns someone that something bad is happening when its not.  
**Watering hole attack:** An attempt to infect websites that a group of end users would normally go to gain access to their information or network.  

## Attacking Websites
**CLF:** Common Log Files are the standard types of logs that every single type of web server generates and they all generate it in the same format.  
**EX:** 127.0.0.1 -- [10/0ct/2017:10:05:24 - 0600] "GET /CompTIA09_small.gif HTTP/1.0" 200 *42213(Bytes in the object returned to client).*  
**Web application attacks**  
1. Cross-site scripting XSS.  
 * Client-side script injected into trusted web sites. **Ex:** `<script>source=http://evilsite</script>`
 2. XML injections.  
  * Inserts XML information that should be there altering the logic of the program.
   **Ex:** http://www.example.com/Newuser.php?user=mike&password=12345&PRODUCT=VoucherGeneric&price=50.00&email-mike@totalsem.com  

## Attacking Applications
**Injection Attacks**  
Injecting extra stuff into an application through an input in order to brake it.  
* **Code injection:** Add extra code to the application to make it do something that it shouldn't be doing.  
* **Command injection:** Uses the application to get to the underlying operating system.  
* **SQL injection:** Type SQL commands through input in order to communicate and retrieve information from the database.  
* **LDAP injection:** LDAP it's used in order to authenticate user and it can be modified to get some information. It is based on X.500 protocol.  

**Buffer Overflow**  
Every time we enter data into an application it goes into a buffer. A buffer is just a part of memory that is set aside to store the data before it actually gets put into the application itself. A *buffer overflow* simply means that we insert so much data into the buffer that the buffer blows up.  

**Integer Overflow:** Bit Overflow with a defined integer value.  

## Exploiting a Target 
**Penetration Testing Steps**  
1. Get Authorization.
  * Define targets.
    * Attack model.
	2. Discover Vulnerabilities.
	  * Reconaissance.
	    * Try to get information.
		3. Exploit vulnerabilities.
		  * Grab user names and passwords.
		    * Take data from a database.
			  * Corrupt webpage. 
			    
				**Attack Model**  
				**White box:** Attackers have extensive knowledge about the target.  
				**black box:** Attackers know nothing about the target, more like strangers (external hacking).  
				**gray box:** Attackers know some information but not a lot.  
				  
				  **Types of discoveries**
				  * Passive discovery (whois lookup), Semi-passive discovery(Looking a Website) , Active discovery (Attacking the server).  

				  **Exploiting the target**  
				  * We are going to use Kali Linux and Metasploit Framework.  

## Vulnerability impact 
**Embedded systems:** It is simply an immutable system that never changes.  
**Lack of vendor support:** if a company is not selling more a specific product we are not going to be able to patch it and keep it up to date.  
**Weak configurations:** it is very important for us to change the default config from a hardware or software and provide the best possible configurations we can.  
**Misconfiguration:** We have a configuration but we have done something incorrectly.  
**Improperly configured accounts:** we have an user account with incorrect rights,privileges and permissions active.  
**Vulnerable business processes:**  
**Memory/buffer vulnerabilities:** resource exhaustion, memory leak, integer overflow, buffer overflow, pointer difference, DSL injection.  

# Dealing with Incidents <a name="dealing_incidents"></a>
## Incident Response 
**Incident response process**  
1. Preparation.
  * The Big plan.
    * Who's doing what? 
	  * Organize the types of incidents that might happen. 
	    * Practice scenarios.
		2. Reporting.
		  * What reports go to whom ?
		    * Escalation. 
			3. Identification.
			  * Recognize what incident has ocurred.
			    * Reports from users.
				  * Check the monitoring tools you use. 
				    * Watch alerts and logs.
					  * Asses the impact.
					    * Define who's involved.
						4. Containment. 
						  * Mitigate the damage.
						    * Stop the attack. 
							  * Segregate the network. 
							    * Shutdown the system. 
								  * Turn off a service. 
								  5. Eradication.
								    * Remove the malware.
									  * Close off vulnerabilities.
									    * Add new controls. 
										6. Recovery.
										  * Restore from backups.
										    * Pull from snapshots.
											  * Hire replacement personnel.
											    * Monitor to ensure good operations. 
												7. Documentation.
												  * Document the incident.
												    * What failed? 
													  * What worked? 
													    * Generate a final report. 

														**Incident Response Plan**  
														1. CIRT - Cyber incident response team.  
														* A group of people whose job is to respond to all incident.
														* Full time or part time.
														* IT security team.
														* IT department.
														* Human Resources.
														* Legal.
														* Public Relations. 
														2. Document incident types/category definitions.
														* Physical access.
														* Malware.
														* Phishing.
														* Social engineering.
														* Data access.
														3. Roles and responsabilities.
														* Users.
														* Help Desk.
														* Human Resources.
														* Database Manager.
														* Incident hotline.
														* Incident Response manager / IR officer.
														* IR team. 
														4. Reporting requirements/escalation.
														* Determine severity.
														* Based on severity have a clear chain of escalation. 
														* Informing law enforcement. 

														**Most importantly practice is the only way we are going to be able to achieve everything on the list successfully**  

## Digital Forensics
Digital forensics is the art, the science of collecting, storing and quantifying digital evidence to be used as the result of some action that takes place.  
**Chain of Custody**  
The whole idea of chain of custody is to show good integrity of the evidence itself.  
**Chain of custody process**  
1. Define the evidence.
2. Document collection methods.
3. Date/time collected.
4. Person(s) handling the evidence.
5. Function of person handling evidence.
6. All locations of the evidence.  

**Order of Volatility**  
Our job is to get as much data of the computer as we can and the order of volatility is basically a checklist that says what to do first and what to keep doing next after that.  
1. Memory.
  * Caches.
    * Routing table.
	  * ARP table.
	  2. Data on the disk.
	    * Optical, flash drives.
		  * Cache files, temp files.
		    * Write blocker enabled tools.
			3. Remotely logged data.
			  * Web site data.
			    * Remote file server logs.
				4. Backups.
				  * Trends.
				    * Low volatility takes time to gather data.  

					**Forensic Data Acquisition**  
					1. Capture the system image.
					2. Network traffic and logs.
					3. Capture video.
					  * Security cameras.
					    * Record time offset.
						4. Take hashes.
						5. Take screenshots.
						6. Interview witnesses.
						7. Track man hours.  

## Contingency Planning
Sometimes, every once in a while really bad incidents take place. We're talking hurricanes or acts of war or some type of really bad thing that's going to take place that is going to massively disrupt your infrastrucutre.  

**Evacuation Plan / Backup or Recovery Site**  
1. Cold Site.
  * It takes weeks to bring online. 
    * Basic office space: buildings, chairs, AC. 
	  * No operational equipment.
	    * Cheapest recovery site.
		2. Warm Site. 
		  * It takes days to bring online.
		    * Operational equipment but little or no data. 
			3. Hot site.
			  * It takes hours to bring online.
			    * Real-time synchronization.
				  * Almost all data ready to go - often just a quick update. 

				  **Order of Restoration** 
				  1. Power 
				  2. Wired LAN.
				  3. ISP link.
				  4. Active directory/DNS/DHCP servers
				  5. Accounting servers.
				  6. Sales and accounting workstations.
				  7. Video production servers.
				  8. Video production workstations.
				  9. Wireless.
				  10. Peripherals(Printers, cameras, scanners, faxes).

## Backups
We can do Full Backups every day in order to save all the information in your system bu it is very time consuming and it takes a lot of memory as well.  
Instead, what we can do is do a backup of the system first and then every time there's a change update it to the backup.  

**Differential Backup:** Backup of all changes since the last full backup.  
**Incremental Backup:** Only backs up changes made from last backup.  
**Snapshots:** A very good way of making a copy of something that happened in the past.  
**Local Backups:** tapes, external drives.
**Offsite Backup:** 
**Cloud Backup:** very powerful to keep your data save. 


